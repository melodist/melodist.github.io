---
layout: post
title: 스프링 DB 2편 - 9. 스프링 트랜잭션 이해
tags: [Spring, SpringDB2]
permalink:  docs Spring SpringDB2_9
date: 2022-11-23 23:34:00
---
# 스프링 트랜잭션 이해
## 스프링 트랜잭션 소개
### 스프링 트랜잭션 추상화
각각의 데이터 접근 기술들은 트랜잭션을 처리하는 방식에 차이가 있음. 예를 들어 JDBC 기술과 JPA 기술은 트랜잭션을 사용하는 코드 자체가 다름

**JDBC 트랜잭션 코드 예시**
```java
public void accountTransfer(String fromId, String toId, int money) throws SQLException {
    Connection con = dataSource.getConnection();
    try {
        con.setAutoCommit(false); //트랜잭션 시작
        //비즈니스 로직
        bizLogic(con, fromId, toId, money);
        con.commit(); //성공시 커밋
    } catch (Exception e) {
        con.rollback(); //실패시 롤백
        throw new IllegalStateException(e);
    } finally {
        release(con);
    }
}
```

**JPA 트랜잭션 코드 예시**
```java
public static void main(String[] args) {
    //엔티티 매니저 팩토리 생성
    EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook");
    EntityManager em = emf.createEntityManager(); //엔티티 매니저 생성
    EntityTransaction tx = em.getTransaction(); //트랜잭션 기능 획득
  
    try {
        tx.begin(); //트랜잭션 시작
        logic(em); //비즈니스 로직
        tx.commit();//트랜잭션 커밋
    } catch (Exception e) {
        tx.rollback(); //트랜잭션 롤백
    } finally {
        em.close(); //엔티티 매니저 종료
    }
    emf.close(); //엔티티 매니저 팩토리 종료
}
```

따라서 JDBC 기술을 사용하다가 JPA 기술로 변경하게 되면 트랜잭션을 사용하는 코드도 모두 함께 변경해야 함

## 프로젝트 생성
## 트랜잭션 적용 확인
## 트랜잭션 적용 위치
## 트랜잭션 AOP 주의 사항
### 프록시 내부 호출
### 초기화 시점
## 트랜잭션 옵션 소개
## 예외와 트랜잭션 커밋, 롤백 
### 기본
### 활용
## 정리