---
layout: post
title: SQL 레벨업 - 5장. 반복문
tags: [SQL, SqlLvUp, UF]
permalink: /docs/SQL/SqlLvUp_5
date: 2023-07-22 23:48:00
---
# 반복문
## 반복문 의존증
- SQL에는 반복문이 없음
- SQL을 적용하기 힘든 작업에 무리하게 SQL을 사용할 필요는 없음
- 미들웨어 또는 O/R 맵퍼 등의 프레임워크가 내부적으로 반복계 코드를 사용하기도 함
- 반복문 의존증 예시
  - 온라인 처리에서 레코드 하나씩 접근하는 SELECT 구문을 반복 사용
  - 배치 처리에서 레코드를 하나씩 호스트 언어에서 처리하고 테이블에 갱신
## 반복계의 공포
### 반복계의 단점
- SQL 실행의 오버헤드
  - 전처리
    1. SQL 구문을 네트워크로 전송
    2. 데이터베이스 연결
    3. SQL 구문 파스
    4. SQL 구문의 실행 계획 생성 또는 평가
  - 후처리
    5. 결과 집합을 네트워크로 전송
  - 1, 5는 오버헤드 중 영향이 적음
  - 2는 커넥션 풀을 사용하여 오버헤드를 줄임
  - 3, 4는 오버헤드 중 가장 영향이 큼
  - 반복계를 사용할 경우 3이 반복되기 때문에 오버헤드가 높아짐
- 병렬 분산이 어려움
  - 반복계에서 실행하는 SQL 구문은 대부분 단순해서 1회의 구문이 접근하는 데이터양이 적음 → I/O 병렬화가 어려움
- 데이터베이스의 진화로 인한 혜택을 받을 수 없음
  - 가벼운 처리를 하는 반복계 구문은 미들웨어 또는 하드웨어 진화에 따른 혜택을 받을 수 없음
### 반복계를 빠르게 만드는 방법은 없을까?
- 반복계를 포장계로 다시 작성 → 실제 상황에서는 사용하기 어려움
- 각각의 SQL 을 빠르게 수정 → 각각의 구문이 간단하여 튜닝의 여지가 없음
- 다중화 처리 → 데이터를 분할할 수 있는 명확한 키가 없거나, 순서가 중요하거나, 병렬화했을 때 물리 리소스가 부족하면 사용할 수 없음
### 반복계의 장점
## SQL에서는 반복을 어떻게 표현할까?