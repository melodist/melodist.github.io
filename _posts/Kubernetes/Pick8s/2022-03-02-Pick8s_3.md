---
layout: post
title: 그림으로 배우는 쿠버네티스 - 3. 애플리케이션 배포법
tags: [Kubernetes, Pick8s]
permalink: /docs/Kubernetes/Pick8s/3
date: 2022-03-02 10:34:00
---
# 애플리케이션 배포법
## 애플리케이션으로 배포되는 오브젝트 형태

1. 파드 (Pod)
2. 디플로이먼트 (Deployment)
3. 레플리카셋 (ReplicaSet)
4. 잡 (Job): 파드로 계속 떠있으면 부담이 되는 작업을 처리하기 위한 오브젝트
5. 크론잡 (CronJob): 잡을 주기적으로 실행할 수 있도록 하는 오브젝트
6. 데몬셋 (DaemonSet): 노드마다 1개씩만 올라가는 파드
7. 스테이트풀셋 (StatefulSet): 순서를 지키면서 배포가 되고 상태를 가지고 있는 파드
    - 기존의 Pod는 stateless

##  파드(Pod)
### pod.yaml
```yaml
apiVersion: v1
kind: Pod
metadata:
    labels:
        run: po-nginx
    name: po-nginx
spec:
    containers:
    - image: nginx
        name: nginx
```
- `apiVersion`: 오브젝트를 생성하기 위해 사용하고 있는 쿠버네티스 API 버전
- `kind`: 오브젝트 종류
- `metadata`: 오브젝트를 유일하게 구분지어 줄 데이터
- `spec`: 오브젝트에 대해 의도한 상태

![애플리케이션 배포법 - 01  파드](https://user-images.githubusercontent.com/52024566/156353704-3b0022d9-046b-4189-984d-adde77105605.png)

## 디플로이먼트(Deployment)
### deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: deploy-nginx
  name: deploy-nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: po-nginx
  template:
    metadata:
      labels:
        app: po-nginx
    spec:
      containers:
      - name: nginx
        image: nginx
```
- `selector`: 디플로이먼트가 관리할 파드를 찾는 방법 정의
- `template`: 파드를 생성하는 템플릿
- 디플로이먼트가 파드를 포함하고 있는 구조

![애플리케이션 배포법 - 02  디플로이먼트](https://user-images.githubusercontent.com/52024566/156353637-26c065da-b30a-4964-99ef-73e3f440e4ee.png)

## 레플리카셋(ReplicaSet)
### replicaset.yaml
```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  labels:
    app: rs-nginx
  name: rs-nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: po-nginx
  template:
    metadata:
      labels:
        app: po-nginx
    spec:
      containers:
      - image: nginx
        name: nginx
```
- 디플로이먼트와 코드 차이는 없음

![애플리케이션 배포법 - 03  레플리카셋](https://user-images.githubusercontent.com/52024566/156353640-13077c0e-8e72-47a9-9aac-e16fc53e1f98.png)

### ReplicaSet 대신 Deployment를 사용하는 이유

![애플리케이션 배포법 - 04  레플리카셋](https://user-images.githubusercontent.com/52024566/156353643-7dbe79ed-6728-4aa9-9bf3-507e9630b477.png)

- 위의 이미지는 컨테이너 버전을 순차적으로 Update하는 Rolling Update 과정을 나타냄
- Deployment가 1개만 있을 경우 Update를 위해서는 추가적인 Deployment가 필요
- 그러한 구조 대신 Deployment가 ReplicaSet을 만들고 ReplicaSet의 복제본으로 업데이트를 진행

## 커맨드(command)와 인자(args)
### 컨테이너에 명령이 필요한 이유
1. 계속 동작하게 하고 싶을 때

![애플리케이션 배포법 - 05  커맨드와 인자](https://user-images.githubusercontent.com/52024566/156374331-3c383556-24e4-4346-a732-4685e2ba89f6.png)

2. 사용자가 원하는 명령을 내리고 싶을 때

![애플리케이션 배포법 - 06  커맨드와 인자](https://user-images.githubusercontent.com/52024566/156374342-dc29a56c-9388-4834-8ad5-c8ee5162fb5c.png)

### 명령에 인자(args)를 추가하는 방법

![애플리케이션 배포법 - 07  커맨드와 인자](https://user-images.githubusercontent.com/52024566/156374343-707c4199-6cc6-407c-b25c-a4c0cb591ef1.png)
