---
layout: post
title: 그림으로 배우는 쿠버네티스 - 7. 쿠버네티스 노드 구성 및 관리
tags: [Kubernetes, Pick8s, UF]
permalink: /docs/Kubernetes/Pick8s/7
date: 2022-03-23 22:30:00
---
# 쿠버네티스 노드 구성 및 관리

## 파드 레이블(label)

![쿠버네티스 파드 구성 및 관리 - 01  레이블](https://user-images.githubusercontent.com/52024566/159715805-3287bb74-d32f-42c0-b707-6695fc284e5a.png)

- 노드의 레이블과 동일한 목적으로 사용
- `k label pod podName key=value`: 파드 레이블 부여
- `k label pod podName key-`: 파드 레이블 부여
- `k get pod -l key=value`: 특정 레이블을 가진 파드 조회

## 정적(Static) 파드

### 정적(Static) 파드로 구성하는 마스터 노드

![쿠버네티스 파드 구성 및 관리 - 02  정적 파드](https://user-images.githubusercontent.com/52024566/159715812-e6318a8f-495f-4ef4-abcc-853690c531de.png "쿠버네티스 파드 구성 및 관리 - 02  정적 파드")

- `kubelet`이 `api`, `etcd`, `c-m`, `sched`를 자동으로 배포

![쿠버네티스 파드 구성 및 관리 - 03  정적 파드](https://user-images.githubusercontent.com/52024566/159715817-58c2c608-c2f7-41be-969d-930fbeff66ad.png)

- 노드의 `/etc/kubernetes/manifests/`에 설정 파일을 위치시킬경우 자동으로 배포
- `scp file node:/etc/kubernetes/manifests/` 명령어로 복사도 가능
- 이러한 파드는 쿠버네티스 스케줄러가 관리하지 않으므로 권장되지 않음

## 컨테이너 상태에 따른 동작(restartPolicy)

![쿠버네티스 파드 구성 및 관리 - 05  컨테이너 상태에 따른 동작](https://user-images.githubusercontent.com/52024566/159715821-be70dccb-9e39-4ab5-b179-880f4a9503fa.png)

- 컨테이너의 종료/실패 여부에 따라 적절한 재시작 여부 설정 가능
- 애플리케이션/오브젝트 설정에 맞는 정책 설정 필요

##  애플리케이션 상태 탐사(startupProbe, livenessProbe, readinessProbe)

- `watch "kubectl describe po liveness-exec | tail"`과 같은 명령어로 탐사

### 탐사 방법 및 체크 방식 정리

![쿠버네티스 파드 구성 및 관리 - 06  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934411-6d24b7a5-3006-4287-a80c-5cb277ea292b.png)

### livenessProbe-exec-periodSeconds10(->30).yaml

![쿠버네티스 파드 구성 및 관리 - 07  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934420-96a8b9c5-91cd-481b-babd-e3eb55bf2e9d.png)

- `cat /tmp/healthy-on`이 실행되면 성공
- `initialDelaySeconds` 후 실행 / `periodSeconds` 주기로 체크

### livenessProbe-httpGet.yaml

![쿠버네티스 파드 구성 및 관리 - 08  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934427-23401c27-a5e9-44dc-a6d3-ca0d9982854b.png)

- `/healthz`로 요청을 보내서 `health-check`라는 값을 받아오면 성공

###  livenessProbe-tcpSocket.yaml

![쿠버네티스 파드 구성 및 관리 - 09  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934428-55caeb75-3664-4e57-897e-8365b0316496.png)

- 80번 포트가 열려있으면 성공

###  readinessProbe-exec-periodSeconds5-w-lb.yaml

![쿠버네티스 파드 구성 및 관리 - 10  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934429-e34a389f-c4c6-4b1a-be8a-93f0871578f2.png)

- `cat /tmp/health-on`이 실행되면 성공
- 실행되지 않을 경우 컨테이너가 종료되는 대신 엔드포인트를 제거

### startupProbe-w-others.yaml

![쿠버네티스 파드 구성 및 관리 - 11  애플리케이션 상태 탐사](https://user-images.githubusercontent.com/52024566/159934437-b14d46c7-7067-47fb-b38c-996cbe49ab8b.png)

- `startupProbe` -> `livenessProbe` -> `readinessProbe` 순서로 동작